function keyDownHandler(e){if(39==e.keyCode)right_press=!0,p1_paddle.r=!0;else if(37==e.keyCode)left_press=!0,p1_paddle.l=!0;else if(32==e.keyCode)if(1==mode)mode=2;else if(3==mode){p1_power_up1=0,p1_power_up2=0,p1_power_up3=0,p2_power_up1=0,p2_power_up2=0,p2_power_up3=0,p1_pu1_on=!1,p1_pu2_on=!1,p1_pu3_on=!1,p1_paddle.x=(p1_paddle.l_bound+p1_paddle.r_bound)/2,p2_paddle.x=(p2_paddle.l_bound+p2_paddle.r_bound)/2;for(var t=0;t<p1_enemies.length;t++)p1_enemies[t].freeze_counter=0,p1_enemies[t].speed_counter=0,p1_enemies[t].reset();for(var a=0;a<p1_enemies.length;a++)p2_enemies[a].freeze_counter=0,p2_enemies[a].speed_counter=0,p2_enemies[a].reset();p1_ball.lives=5,p2_ball.lives=5,p1_ball.reset(),p2_ball.reset(),mode=2}}function keyUpHandler(e){39==e.keyCode?(right_press=!1,p1_paddle.r=!1):37==e.keyCode?(left_press=!1,p1_paddle.l=!1):49==e.keyCode?p1_power_up1>0&&(p1_pu1_on=!0):50==e.keyCode?p1_power_up2>0&&(p1_pu2_on=!0):51==e.keyCode&&p1_power_up3>0&&(p1_pu3_on=!0)}function getMousePos(e,t){var a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}}function doMouseDown(e){var t=getMousePos(canvas,e),a=t.x,i=t.y;1==mode?a>=canvas.width-canvas.width/4-250&&a<=canvas.width-canvas.width/4-150&&i>=canvas.height/2+20&&i<=canvas.height/2+70?level=1:a>=canvas.width-canvas.width/4-125&&a<=canvas.width-canvas.width/4-25&&i>=canvas.height/2+20&&i<=canvas.height/2+70?level=2:a>=canvas.width-canvas.width/4+25&&a<=canvas.width-canvas.width/4+125&&i>=canvas.height/2+20&&i<=canvas.height/2+70?level=3:a>=canvas.width-canvas.width/4+150&&a<=canvas.width-canvas.width/4+250&&i>=canvas.height/2+20&&i<=canvas.height/2+70&&(level=4):3==mode&&(dark_blue=a>=canvas.width-canvas.width/4-100&&a<=canvas.width-canvas.width/4+100&&i>=canvas.height/2+85&&i<=canvas.height/2+135?!0:!1)}function doMouseUp(e){var t=getMousePos(canvas,e),a=t.x,i=t.y;if(3==mode)if(a>=canvas.width-canvas.width/4-100&&a<=canvas.width-canvas.width/4+100&&i>=canvas.height/2+85&&i<=canvas.height/2+135){dark_blue=!1,p1_power_up1=0,p1_power_up2=0,p1_power_up3=0,p2_power_up1=0,p2_power_up2=0,p2_power_up3=0,p1_pu1_on=!1,p1_pu2_on=!1,p1_pu3_on=!1,p1_paddle.x=(p1_paddle.l_bound+p1_paddle.r_bound)/2,p2_paddle.x=(p2_paddle.l_bound+p2_paddle.r_bound)/2;for(var l=0;l<p1_enemies.length;l++)p1_enemies[l].freeze_counter=0,p1_enemies[l].speed_counter=0,p1_enemies[l].reset();for(var s=0;s<p1_enemies.length;s++)p2_enemies[s].freeze_counter=0,p2_enemies[s].speed_counter=0,p2_enemies[s].reset();p1_ball.lives=5,p2_ball.lives=5,p1_ball.reset(),p2_ball.reset(),mode=1}else dark_blue=!1}function Ball(e,t,a){this.l_bound=e,this.r_bound=t,this.p=a,this.lives=5,this.radius=10,this.x=this.p.x+paddle_w/2,this.y=this.p.y-this.radius;var i=Math.floor(2*Math.random());0==i?this.x_change=2:this.x_change=-2,this.y_change=4,this.boost_counter=0,this.reset=function(){this.x=this.p.x+paddle_w/2,this.y=this.p.y-this.radius,i=Math.floor(2*Math.random()),0==i?this.x_change=2:this.x_change=-2,this.y_change=4,this.boost_counter=0},this.move=function(){this.x-this.radius<=this.l_bound&&(0==this.x_change?this.x_change=2:this.x_change=Math.abs(this.x_change)),this.x+this.radius>=this.r_bound&&(0==this.x_change?this.x_change=-2:this.x_change=-Math.abs(this.x_change)),this.y-this.radius<=0&&(this.y_change=Math.abs(this.y_change)),this.y+this.radius>=this.p.y&&(this.x+this.radius>this.p.x&&this.x-this.radius<this.p.x+this.p.w?(this.y_change=-Math.abs(this.y_change),1==this.p.r?this.x_change>=2&&this.x_change<5?this.x_change+=1:this.x_change<2&&(this.x_change=2):1==this.p.l&&(this.x_change<=-2&&this.x_change>-5?this.x_change-=1:this.x_change>-2&&(this.x_change=-2))):this.y+this.radius>floor_height&&(this.reset(),this.lives>0&&(this.lives-=1))),this.x+=this.x_change,this.y+=this.y_change},this.draw=function(){this.move(),ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI),ctx.fillStyle="#0096DD",ctx.fill(),ctx.closePath(),this.boost_counter>0?(this.radius=40,this.boost_counter-=1):this.radius=10,this.lives<1&&(loser_l=this.l_bound,mode=3)}}function Paddle(e,t){this.l_bound=e,this.r_bound=t,this.w=paddle_w,this.h=10,this.x=(this.l_bound+this.r_bound)/2,this.y=floor_height-this.h,this.r=!1,this.l=!1,this.draw=function(){ctx.beginPath(),ctx.rect(this.x,this.y,this.w,this.h),ctx.fillStyle="red",ctx.fill(),ctx.closePath()}}function Enemy(e,t,a){this.l_bound=e,this.r_bound=t-en_size,this.b=a,this.x=Math.floor(Math.random()*(this.r_bound-this.l_bound))+this.l_bound,this.y=Math.floor(Math.random()*-canvas.height/2),this.y_change=.2,this.freeze_counter=0,this.speed_counter=0,this.state=Math.floor(20*Math.random())+1,this.reset=function(){this.x=Math.floor(Math.random()*(this.r_bound-this.l_bound))+this.l_bound,this.y=Math.floor(Math.random()*canvas.height/2*-1),this.state=Math.floor(20*Math.random())+1},this.move=function(){this.y>floor_height?(this.b.lives>0&&(this.b.lives-=1),this.reset()):this.y+=this.y_change},this.powerUp=function(){1==this.state?this.b==p1_ball&&3>p1_power_up1?p1_power_up1+=1:this.b==p2_ball&&3>p2_power_up1&&(p2_power_up1+=1):2==this.state?this.b==p1_ball&&3>p1_power_up2?p1_power_up2+=1:this.b==p2_ball&&3>p2_power_up2&&(p2_power_up2+=1):3==this.state&&(this.b==p1_ball&&3>p1_power_up3?p1_power_up3+=1:this.b==p2_ball&&3>p2_power_up3&&(p2_power_up3+=1))},this.colDetect=function(){Math.abs(this.y+en_size/2-this.b.y)<=en_size/2+this.b.radius&&Math.abs(this.x+en_size/2-this.b.x)<=en_size/2+this.b.radius&&(this.b.x<this.x?(this.powerUp(),this.reset(),this.b.x_change=-Math.abs(this.b.x_change)):this.b.x>this.x+en_size?(this.powerUp(),this.reset(),this.b.x_change=Math.abs(this.b.x_change)):this.b.y<this.y?(this.powerUp(),this.reset(),this.b.y_change=-Math.abs(this.b.y_change)):this.b.y>this.y+en_size&&(this.powerUp(),this.reset(),this.b.y_change=Math.abs(this.b.y_change)))},this.draw=function(){this.colDetect(),ctx.beginPath(),ctx.rect(this.x,this.y,en_size,en_size),this.state>3?ctx.fillStyle="green":ctx.fillStyle="purple",ctx.fill(),ctx.closePath(),this.move(),this.freeze_counter>0?(this.y_change=0,this.freeze_counter-=1):this.speed_counter>0?(this.y_change=.4,this.speed_counter-=1):this.y_change=.2}}function paddleMove(){if(right_press&&p1_paddle.x<p1_paddle.r_bound?p1_paddle.x+=7:left_press&&p1_paddle.x>p1_paddle.l_bound&&(p1_paddle.x-=7),p2_paddle.x+paddle_w/2<p2_ball.x&&p2_paddle.x<p2_paddle.r_bound){switch(level){case 1:p2_paddle.x+=2;break;case 2:p2_paddle.x+=4;break;case 3:p2_paddle.x+=4.3;break;case 4:p2_paddle.x=p2_ball.x-p2_paddle.w/2}p2_paddle.r=!0,p2_paddle.l=!1}else if(p2_paddle.x+paddle_w/2>p2_ball.x&&p2_paddle.x>p2_paddle.l_bound){switch(level){case 1:p2_paddle.x-=2;break;case 2:p2_paddle.x-=4;break;case 3:p2_paddle.x-=4.3;break;case 4:p2_paddle.x=p2_ball.x-p2_paddle.w/2}p2_paddle.r=!1,p2_paddle.l=!0}else{var e=Math.floor(2*Math.random());switch(e){case 0:p2_paddle.r=!0,p2_paddle.l=!1;break;case 1:p2_paddle.r=!1,p2_paddle.l=!0}}}function powerUpCheck(){if(p1_pu1_on&&(p1_ball.boost_counter=500,p1_power_up1-=1,p1_pu1_on=!1),p1_pu2_on){for(var e=0;e<p1_enemies.length;e++)p1_enemies[e].freeze_counter=500,p1_enemies[e].speed_counter=0;p1_power_up2-=1,p1_pu2_on=!1}if(p1_pu3_on){for(var t=0;t<p1_enemies.length;t++)p2_enemies[t].speed_counter=500,p2_enemies[t].freeze_counter=0;p1_power_up3-=1,p1_pu3_on=!1}if(p2_power_up1>0){var a=Math.floor(500*Math.random())+1;1==a&&(p2_ball.boost_counter=500,p2_power_up1-=1)}if(p2_power_up2>0){var i=Math.floor(500*Math.random())+1;if(1==i){for(var e=0;e<p1_enemies.length;e++)p2_enemies[e].freeze_counter=500,p2_enemies[e].speed_counter=0;p2_power_up2-=1}}if(p2_power_up3>0){var l=Math.floor(500*Math.random())+1;if(1==l){for(var t=0;t<p1_enemies.length;t++)p1_enemies[t].speed_counter=500,p1_enemies[t].freeze_counter=0;p2_power_up3-=1}}}function powerUpDisplay(){ctx.beginPath(),ctx.rect(wall_w+pu_size,floor_height,pu_size,pu_size),ctx.rect(canvas.width/4-pu_size/2,floor_height,pu_size,pu_size),ctx.rect(canvas.width/2-wall_w/2-2*pu_size,floor_height,pu_size,pu_size),ctx.rect(canvas.width/2+wall_w/2+pu_size,floor_height,pu_size,pu_size),ctx.rect(canvas.width-canvas.width/4-pu_size/2,floor_height,pu_size,pu_size),ctx.rect(canvas.width-wall_w/2-2*pu_size,floor_height,pu_size,pu_size),ctx.fillStyle="LightPink",ctx.fill(),ctx.closePath(),ctx.textAlign="end",ctx.font="bold 20px Verdana",ctx.fillStyle="FireBrick",ctx.fillText("1",wall_w+pu_size-10,canvas.height-pu_size/4),ctx.fillText("2",canvas.width/4-pu_size/2-10,canvas.height-pu_size/4),ctx.fillText("3",canvas.width/2-wall_w/2-2*pu_size-10,canvas.height-pu_size/4),ctx.textAlign="start",ctx.font="10px Verdana",ctx.fillStyle="Black",ctx.fillText("Big Ball",wall_w+pu_size+5,floor_height+10),ctx.fillText("Freeze",canvas.width/4-pu_size/2+5,floor_height+10),ctx.fillText("Yours",canvas.width/4-pu_size/2+5,floor_height+20),ctx.fillText("Speed",canvas.width/2-wall_w/2-2*pu_size+5,floor_height+10),ctx.fillText("Enemy's",canvas.width/2-wall_w/2-2*pu_size+5,floor_height+20),ctx.fillText("Big Ball",canvas.width/2+wall_w/2+pu_size+5,floor_height+10),ctx.fillText("Freeze",canvas.width-canvas.width/4-pu_size/2+5,floor_height+10),ctx.fillText("Yours",canvas.width-canvas.width/4-pu_size/2+5,floor_height+20),ctx.fillText("Speed",canvas.width-wall_w/2-2*pu_size+5,floor_height+10),ctx.fillText("Enemy's",canvas.width-wall_w/2-2*pu_size+5,floor_height+20),ctx.font="bold 20px Verdana",ctx.fillText(p1_power_up1,wall_w+pu_size+15,floor_height+45),ctx.fillText(p1_power_up2,canvas.width/4-pu_size/2+15,floor_height+45),ctx.fillText(p1_power_up3,canvas.width/2-wall_w/2-2*pu_size+15,floor_height+45),ctx.fillText(p2_power_up1,canvas.width/2+wall_w/2+pu_size+15,floor_height+45),ctx.fillText(p2_power_up2,canvas.width-canvas.width/4-pu_size/2+15,floor_height+45),ctx.fillText(p2_power_up3,canvas.width-wall_w/2-2*pu_size+15,floor_height+45)}function displayLives(){ctx.textAlign="start",ctx.font="bold 20px Verdana",ctx.fillStyle="FireBrick",ctx.fillText(p1_ball.lives,p1_ball.l_bound+15,25),ctx.fillText(p2_ball.lives,p2_ball.l_bound+15,25)}function drawWall(){ctx.beginPath(),ctx.rect(0,floor_height,canvas.width,canvas.height),ctx.fillStyle="LightGreen",ctx.fill(),ctx.beginPath(),ctx.rect(0,0,wall_w,canvas.height),ctx.rect(canvas.width/2-wall_w/2,0,wall_w,canvas.height),ctx.rect(canvas.width-wall_w,0,wall_w,canvas.height),ctx.fillStyle="black",ctx.fill(),ctx.closePath()}function startScreen(){ctx.textAlign="end",ctx.font="bold 40px Verdana",ctx.fillStyle="DarkSlateGrey",ctx.fillText("Paddle",canvas.width/2-wall_w,canvas.height/5),ctx.textAlign="start",ctx.fillText("Baddle",canvas.width/2+wall_w,canvas.height/5),ctx.textAlign="center",ctx.font="bold 30px Verdana",ctx.fillStyle="DarkBlue",ctx.fillText("This is your side.",canvas.width/4,canvas.height/3),ctx.fillStyle="DarkRed",ctx.fillText("This is the enemy's side.",canvas.width-canvas.width/4,canvas.height/3),ctx.font="20px Verdana",ctx.fillStyle="Indigo",ctx.fillText("LEFT and RIGHT control paddle.",canvas.width/4,canvas.height/2),ctx.fillText("Don't let the ball drop!",canvas.width/4,canvas.height/2+25),ctx.fillText("Don't let the blocks pass!",canvas.width/4,canvas.height/2+50),ctx.fillText("Purple blocks give powerups.",canvas.width/4,canvas.height/2+75),ctx.fillText("1, 2, and 3 to use powerups.",canvas.width/4,canvas.height/2+100),ctx.fillStyle="Red",ctx.font="bold 30px Verdana",ctx.fillText("SPACE to start.",canvas.width/4,canvas.height/2+135),ctx.textAlign="start",ctx.font="20px Verdana",ctx.fillText("Your lives",2*wall_w,25),ctx.fillText("Opponent's lives",canvas.width/2+2*wall_w,25),drawWall(),ctx.textAlign="center",ctx.font="20px Verdana",ctx.fillStyle="Indigo",ctx.fillText("Your powerups are down here.",canvas.width/4,canvas.height-pu_size/2),ctx.fillText("Enemy powerups are down here.",canvas.width-canvas.width/4,canvas.height-pu_size/2),ctx.font="bold 25px Verdana",ctx.fillStyle="Black",ctx.fillText("Level?",canvas.width-canvas.width/4,canvas.height/2),ctx.beginPath(),ctx.rect(canvas.width-canvas.width/4-250,canvas.height/2+20,100,50),1==level?ctx.fillStyle="Magenta":ctx.fillStyle="LightBlue",ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.rect(canvas.width-canvas.width/4-125,canvas.height/2+20,100,50),2==level?ctx.fillStyle="Magenta":ctx.fillStyle="LightBlue",ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.rect(canvas.width-canvas.width/4+25,canvas.height/2+20,100,50),3==level?ctx.fillStyle="Magenta":ctx.fillStyle="LightBlue",ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.rect(canvas.width-canvas.width/4+150,canvas.height/2+20,100,50),4==level?ctx.fillStyle="Magenta":ctx.fillStyle="LightBlue",ctx.fill(),ctx.closePath(),ctx.textAlign="start",ctx.fillStyle="Black",ctx.fillText("Easy",canvas.width-canvas.width/4-235,canvas.height/2+50),ctx.font="bold 20px Verdana",ctx.fillText("Medium",canvas.width-canvas.width/4-120,canvas.height/2+50),ctx.font="bold 25px Verdana",ctx.fillText("Hard",canvas.width-canvas.width/4+40,canvas.height/2+50),ctx.font="bold 12px Verdana",ctx.fillText("Impossible?",canvas.width-canvas.width/4+158,canvas.height/2+50)}function gamePlay(){powerUpCheck(),p1_ball.draw(),p2_ball.draw(),paddleMove(),p1_paddle.draw(),p2_paddle.draw();for(var e=0;e<p1_enemies.length;e++)p1_enemies[e].draw();for(var t=0;t<p2_enemies.length;t++)p2_enemies[t].draw();displayLives(),drawWall(),powerUpDisplay()}function endScreen(){loser_l<canvas.width/2?(ctx.textAlign="center",ctx.font="bold 40px Verdana",ctx.fillStyle="DarkRed",ctx.fillText("Loser :(",canvas.width/4,canvas.height/3),ctx.fillStyle="DarkBlue",ctx.fillText("Winner! ^_^",canvas.width-canvas.width/4,canvas.height/3)):(ctx.textAlign="center",ctx.font="bold 40px Verdana",ctx.fillStyle="DarkRed",ctx.fillText("Loser :(",canvas.width-canvas.width/4,canvas.height/3),ctx.fillStyle="DarkBlue",ctx.fillText("Winner! ^_^",canvas.width/4,canvas.height/3)),ctx.fillStyle="Red",ctx.fillText("SPACE to rematch.",canvas.width/4,canvas.height/2+135),ctx.beginPath(),ctx.rect(canvas.width-canvas.width/4-100,canvas.height/2+85,200,50),dark_blue?ctx.fillStyle="DarkBlue":ctx.fillStyle="LightBlue",ctx.fill(),ctx.closePath(),ctx.textAlign="start",ctx.font="bold 15px Verdana",ctx.fillStyle="DarkRed",ctx.fillText("Return to start screen",canvas.width-canvas.width/4-92,canvas.height/2+115),drawWall()}function draw(){switch(ctx.clearRect(0,0,canvas.width,canvas.height),mode){case 1:startScreen();break;case 2:gamePlay();break;case 3:endScreen()}}var canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),mode=1,loser_l=30,wall_w=14,paddle_w=74,en_size=30,pu_size=50,floor_height=canvas.height-pu_size,right_press=!1,left_press=!1,level=1,dark_blue=!1,p1_power_up1=0,p1_power_up2=0,p1_power_up3=0,p2_power_up1=0,p2_power_up2=0,p2_power_up3=0,p1_pu1_on=!1,p1_pu2_on=!1,p1_pu3_on=!1;document.addEventListener("keydown",keyDownHandler,!1),document.addEventListener("keyup",keyUpHandler,!1),canvas.addEventListener("mousedown",doMouseDown,!1),canvas.addEventListener("mouseup",doMouseUp,!1);for(var p1_paddle=new Paddle(wall_w,canvas.width/2-wall_w/2-paddle_w),p2_paddle=new Paddle(canvas.width/2+wall_w/2,canvas.width-paddle_w-wall_w),p1_ball=new Ball(wall_w/2,canvas.width/2,p1_paddle),p2_ball=new Ball(canvas.width/2,canvas.width-wall_w/2,p2_paddle),p1_enemies=[],p2_enemies=[],i=0;10>i;i++)p1_enemies[i]=new Enemy(wall_w,canvas.width/2-wall_w/2,p1_ball);for(var j=0;10>j;j++)p2_enemies[j]=new Enemy(canvas.width/2+wall_w/2,canvas.width-en_size-wall_w,p2_ball);setInterval(draw,10);